# SPDX-FileCopyrightText: 2025 Karsten Teichmann
#
# SPDX-License-Identifier: MIT

# @file
# @brief Common definition of user-specific application paths.
# @description
# This file is sourced from multiple scripts to ensure that they all share the same common configuration when launching 
# emulationstation or any game.  
# It is required because almost any path used in the code can be adjusted and re-configured, both system-wide as well as
# user-specific paths.    
# The following definitions are made in this file:
# - `XDG_*` - runtime, config, data, state, cache
# - `XDG_HOME` - special variable to quickly relocate all XDG dirs (except runtime) (default $HOME).  
#    The subdirectory path of each variable will be as it normally is for HOME.
# - `ES_DATA_DIR`, `ES_STATE_DIR`, `ES_CACHE_DIR`
# - `ROMS_ROOT_DIR`
# - `SAVES_ROOT_DIR`
# - `TMP_DIR`  
#
# ...basically anything that will change with the user.  
#  
# All definitions are declared in a way that will not change or delete pre-existing settings:  
# ```
# VARNAME=${VARNAME:-default}
# ```
# Where `default` often is a sub-directory of another declared path / variable.
#   
# This file also contains a few functions/general purpose utilities which are used from multiple places.

# make sure all XDG variables are defined and exported
XDG_RUNTIME_DIR=${XDG_RUNTIME_DIR:-/var/run/user/$(id -u)}
XDG_HOME=${XDG_HOME:-$(realpath -s "$HOME")}
XDG_CONFIG_HOME=${XDG_CONFIG_HOME:-$(realpath -s "$XDG_HOME"/.config)}
XDG_DATA_HOME=${XDG_DATA_HOME:-$(realpath -s "$XDG_HOME"/.local/share)}
XDG_STATE_HOME=${XDG_STATE_HOME:-$(realpath -s "$XDG_HOME"/.local/state)}
XDG_CACHE_HOME=${XDG_CACHE_HOME:-$(realpath -s "$XDG_HOME"/.cache)}
export XDG_RUNTIME_DIR XDG_CONFIG_HOME XDG_DATA_HOME XDG_STATE_HOME XDG_CACHE_HOME

export ES_HOME=${ES_HOME:-$(realpath -s "$HOME")}
export ES_CONFIG_HOME=${ES_CONFIG_HOME:-$(realpath -s "$XDG_CONFIG_HOME"/emulationstation)}
ES_DATA_DIR=${ES_DATA_DIR:-$(realpath -s "$XDG_DATA_HOME"/emulationstation)}
ES_STATE_DIR=${ES_STATE_DIR:-$(realpath -s "$XDG_STATE_HOME"/emulationstation)}
ES_CACHE_DIR=${ES_CACHE_DIR:-$(realpath -s "$XDG_CACHE_HOME"/emulationstation)}
mkdir -p "$ES_HOME" "$ES_CONFIG_HOME" "$ES_DATA_DIR" "$ES_STATE_DIR" "$ES_CACHE_DIR"
export ES_DATA_DIR ES_STATE_DIR ES_CACHE_DIR

DEFAULT_ROMS_ROOT=~/ROMs
ROMS_ROOT_DIR=${ROMS_ROOT_DIR:-$(realpath -s "$DEFAULT_ROMS_ROOT")}
SAVES_ROOT_DIR=${SAVES_ROOT_DIR:-$ES_DATA_DIR/saves}
export ROMS_ROOT_DIR SAVES_ROOT_DIR
mkdir -p "$ROMS_ROOT_DIR" "$SAVES_ROOT_DIR"

TMP_DIR="$XDG_RUNTIME_DIR/tmp/${BASHPID:-$(uuidgen)}"

source "${SH_LIB_DIR:-"$(dirname "$BASH_SOURCE")"}"/generic-utils.lib
