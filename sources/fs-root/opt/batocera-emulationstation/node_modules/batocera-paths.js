/**
 * @file
 * @brief JS-pendant to `/etc/batocera-paths.conf`, maintained separately for performance reasons.
 * This file reads or defines the package-specific file path configuration properties for the current runtime.  
 * In theory, it is duplicated code because it does the same thing as `batocera-paths.conf`.  
 * However, node can't parse shell scripts without workarounds and bash can't directly execute js. Therefore, there is 
 * no direct way to use the very same file in both contexts, without having one context spawn a sub-process just to map
 * (and parse) the configuration.  
 * This would incur a needless performance hit, because the configuration has to be read everytime.  
 *   
 * Most paths defined in this file follow the same pattern as 'batocera-paths.conf', with one exception:  
 * `FS_ROOT` will assumed to be `/` when not passed from the outside. The reason is that the entire js code is located
 * under `$BTC_PKG_DIR`, which itself is a changable path based on `FS_ROOT`.  
 * The most reliable way to detect `FS_ROOT` would be to walk up the directory path and pick the first directory which 
 * contains `etc/batocera-paths.conf`. But this is an expensive operation and `btc-config` is normally used internally 
 * by scripts which have configured `FS_ROOT` already. The difference would only be noticable in direct manual usage in 
 * a terminal with unpackaged sources (or complex multi-package installations using different package directories).  
 *  
 * **Note:**
 * This module does not export anything. For the sake of convenience, the path configuration is placed in `globalThis.PATHS` instead.  
 * So, it is sufficient to use `require('batocera-paths')`.
 */

if (typeof globalThis.PATHS == 'object'){ return }

const { envVarOrAbsPath } = require('utils/path');

let p = {};
p.FS_ROOT = envVarOrAbsPath('FS_ROOT', '');
p.CONFIG_ROOT = envVarOrAbsPath('CONFIG_ROOT', p.FS_ROOT + '/etc/batocera-emulationstation');
p.DROPIN_DIR = envVarOrAbsPath('DROPIN_DIR', p.CONFIG_ROOT + '/conf.d');
p.BTC_PKG_DIR = envVarOrAbsPath('BTC_PKG_DIR', p.FS_ROOT + '/opt/batocera-emulationstation');
p.BTC_BIN_DIR = envVarOrAbsPath('BTC_BIN_DIR', p.BTC_PKG_DIR + '/bin');
// specific to btc-config. Required when doing a property import/merge with the original stuff from batocera
p.INBUILD_CONFIG_PATH = envVarOrAbsPath('INBUILD_CONFIG_PATH ', p.BTC_PKG_DIR + '/conf.d');

// the following paths are mostly for the sake of completeness and tests, btc-config does not interfere with them
/*p.EL_PKG_DIR:
p.SH_LIB_DIR:
*/

globalThis.PATHS = p;
